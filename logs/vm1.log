---- VM1 Log ----
=== Multi-Operation Test ===
world_size: 2
master_addr: 192.168.0.6
rank: 0
data_count: 4096
============================

Rank 0: Creating communication group...
devices num 1
rxe_eth1

===== Device Attributes =====
Maximum QPs: 65536
Maximum CQs: 16384
Maximum MRs: 4096
Maximum PDs: 32764
Maximum QP WR: 16384
Maximum CQ entries: 32767
Maximum MR size: 18446744073709551615 bytes
=============================


===== Port Attributes =====
Port state: 4 (0=DOWN, 1=INIT, 2=ARMED, 3=ACTIVE)
Physical state: 5
LID: 0x0000 (0)
Active MTU: 3 (256*2^3 = 2048 bytes)
Max MTU: 5 (256*2^5 = 8192 bytes)
Active speed: 1
Active width: 1 (1=1x, 2=4x, 4=8x, 8=12x)
GID table length: 1024
Link layer: 2 (0=IB, 1=Ethernet)
============================

my ip: 172.16.0.5
controller ip: 192.168.0.3 
connect to ranks success.
connect to controller success.
group id: 1!
Rank 0: Creating communicator...
my QP number = 18
rank0 qp num 18
rank1 qp num 133
File received and saved to: /root/NetLab/topology.yaml
send file to fd: 6 succeed.
parse yaml
Remote QP number = 0xb
Remote GID = 00:00:00:00:00:00:00:00:00:00:ff:ff:ac:10:00:15
ret of init 0
mtu: 3
ret of rtr 0
qp status: 2
ret of rts 0

========== Test 1: Reduce (root=0) ==========
Rank 0: Starting Reduce (root=0)...
Reduce: len=4096, PAYLOAD_COUNT=1024, message_num=4
Rank 0: Prepared imm_data=0x00005000 (dest=0, prim=1, op=1, dtype=0)
[CTRL] Sending control message with imm_data=0x00005000
[CTRL] Control message sent successfully
Reduce root rank 0: post recv ret 0
Reduce root rank 0: post recv ret 0
Reduce root rank 0: post recv ret 0
Reduce root rank 0: post recv ret 0
Reduce root send success
Reduce root send success
Reduce root receive success
Reduce root receive success
Reduce root send success
Reduce root receive success
Reduce root send success
Reduce root receive success
Reduce operation completed for rank 0
Reduce (root=0) completed, Time taken: 1.955000 milliseconds
  [Rank 0] Reduce result verified: PASS (first 3: 0, 3, 6)

========== Test 2: AllReduce ==========
Rank 0: Starting AllReduce...
AllReduce: len=4096, PAYLOAD_COUNT=1024, message_num=4
AllReduce: Prepared imm_data=0xFFFF1000 (dest=0xFFFF, prim=0, op=1, dtype=0)
[CTRL] Sending control message with imm_data=0xFFFF1000
[CTRL] Control message sent successfully
i: 0, post recv ret 0
i: 1, post recv ret 0
i: 2, post recv ret 0
i: 3, post recv ret 0
[AllReduce] Starting poll loop: waiting for 4 messages, sent 2
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=0, wr_id=0, byte_len=4096
[AllReduce] SEND success for wr_id=0
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=128, wr_id=0, byte_len=4096
[AllReduce] RECV success for wr_id=0
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=0, wr_id=1, byte_len=4096
[AllReduce] SEND success for wr_id=1
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=128, wr_id=1, byte_len=4096
[AllReduce] RECV success for wr_id=1
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=0, wr_id=2, byte_len=4096
[AllReduce] SEND success for wr_id=2
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=128, wr_id=2, byte_len=4096
[AllReduce] RECV success for wr_id=2
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=0, wr_id=3, byte_len=4096
[AllReduce] SEND success for wr_id=3
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=128, wr_id=3, byte_len=4096
[AllReduce] RECV success for wr_id=3
[AllReduce] Completed: received all 4 messages
AllReduce completed, Time taken: 0.659000 milliseconds
  [Rank 0] AllReduce result verified: PASS (first 3: 0, 3, 6)

========== Test 3: Reduce (root=1) ==========
Rank 0: Starting Reduce (root=1)...
Reduce: len=4096, PAYLOAD_COUNT=1024, message_num=4
Rank 0: Prepared imm_data=0x00015000 (dest=1, prim=1, op=1, dtype=0)
[CTRL] Sending control message with imm_data=0x00015000
[CTRL] Control message sent successfully
Reduce non-root rank 0 send success
Reduce non-root rank 0 send success
Reduce non-root rank 0 send success
Reduce non-root rank 0 send success
Reduce operation completed for rank 0
Reduce (root=1) completed, Time taken: 0.443000 milliseconds
  [Rank 0] Non-root, skipping verification

========== Test 4: AllReduce (again) ==========
Rank 0: Starting AllReduce (again)...
AllReduce: len=4096, PAYLOAD_COUNT=1024, message_num=4
AllReduce: Prepared imm_data=0xFFFF1000 (dest=0xFFFF, prim=0, op=1, dtype=0)
[CTRL] Sending control message with imm_data=0xFFFF1000
[CTRL] Control message sent successfully
i: 0, post recv ret 0
i: 1, post recv ret 0
i: 2, post recv ret 0
i: 3, post recv ret 0
[AllReduce] Starting poll loop: waiting for 4 messages, sent 2
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=0, wr_id=0, byte_len=4096
[AllReduce] SEND success for wr_id=0
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=0, wr_id=1, byte_len=4096
[AllReduce] SEND success for wr_id=1
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=128, wr_id=0, byte_len=4096
[AllReduce] RECV success for wr_id=0
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=128, wr_id=1, byte_len=4096
[AllReduce] RECV success for wr_id=1
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=0, wr_id=2, byte_len=4096
[AllReduce] SEND success for wr_id=2
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=128, wr_id=2, byte_len=4096
[AllReduce] RECV success for wr_id=2
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=0, wr_id=3, byte_len=4096
[AllReduce] SEND success for wr_id=3
[AllReduce] poll_cq returned 1 completions
[AllReduce] WC[0]: status=0, opcode=128, wr_id=3, byte_len=4096
[AllReduce] RECV success for wr_id=3
[AllReduce] Completed: received all 4 messages
AllReduce (again) completed, Time taken: 0.681000 milliseconds
  [Rank 0] AllReduce result verified: PASS (first 3: 0, 3, 6)

========== Test 5: Broadcast (root=0) ==========
Rank 0: Starting Broadcast (root=0)...
Rank 0: Before broadcast, in_data[0..2] = 0, 1, 2
Broadcast: len=4096, PAYLOAD_COUNT=1024, message_num=4
Rank 0: Prepared imm_data=0x00009000 (dest=0, prim=2, op=1, dtype=0)
[CTRL] Sending control message with imm_data=0x00009000
[CTRL] Control message sent successfully
Broadcast root rank 0 send success
Broadcast root rank 0 send success
Broadcast root rank 0 send success
Broadcast root rank 0 send success
Broadcast operation completed for rank 0
Broadcast (root=0) completed, Time taken: 0.359000 milliseconds
Rank 0: After broadcast, in_data[0..2] = 0, 1, 2
  [Rank 0] Broadcast result verified: PASS (first 3: 0, 1, 2)

========== Test 6: Broadcast (root=1) ==========
Rank 0: Starting Broadcast (root=1)...
Rank 0: Before broadcast, in_data[0..2] = 0, 1, 2
Broadcast: len=4096, PAYLOAD_COUNT=1024, message_num=4
Rank 0: Non-root, waiting to receive broadcast from root 1
Broadcast non-root rank 0: post recv ret 0
Broadcast non-root rank 0: post recv ret 0
Broadcast non-root rank 0: post recv ret 0
Broadcast non-root rank 0: post recv ret 0
Broadcast non-root rank 0 receive success
Broadcast non-root rank 0 receive success
Broadcast non-root rank 0 receive success
Broadcast non-root rank 0 receive success
Broadcast operation completed for rank 0
Broadcast (root=1) completed, Time taken: 0.402000 milliseconds
Rank 0: After broadcast, in_data[0..2] = 0, 2, 4
  [Rank 0] Broadcast result verified: PASS (first 3: 0, 2, 4)

========================================
       Multi-Operation Test Summary
========================================
Rank: 0
Tests passed: 6
Tests failed: 0
Overall: ALL PASSED
========================================
